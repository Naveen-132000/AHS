{% extends 'layout.html' %}

{% block title %}Display{% endblock %}
{% block content %}
<!--<html>
<head>
    <title>Chart</title>
</head>
<body><center>
    <img src="data:image/png;base64,{{ chart_url }}" alt="Chart"></center>
    <div>
        <h2>Common Skills found in resume and JD</h2>
        <div class="upload">
            <div class="wrapper">
               <div class="left">
                 
                      {{comm}}
               </div>
              
            </div>
          </div>
    </div>
</body>
</html>-->
<!DOCTYPE html>
<html>
<head>
    <title>Animated Circle Chart</title>
    <style>
        body {
            background-color: #f8f8f8;
        }

        canvas {
            display: block;
            margin: 5px auto;
            background-color: #fff;
        }

        .chart-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .chart-heading {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .chart-subheading {
            font-size: 18px;
        }
        .points-container {
            display: flex;
            justify-content: space-evenly;
            align-items: flex-end;
            
            border: solid 2px;
            padding: 20px;
          }
          .points-bar {
            width: 200px;
            height: 20px;
            background-color: #f1f1f1;
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 10px;
          }
          
          .progress {
            height: 100%;
            width: 0;
            transition: width 1s ease;
            border-radius: 20px;
          }
          
          .points-text {
            position: absolute;
            top: 50%;
            right: 5px;
            transform: translateY(-50%);
            color: #333;
            font-weight: bold;
            font-size: 16px;
          }
          .points-label {
            text-align: center;
            color: #333;
            font-weight: bold;
          }
          
    </style>
</head>
<body>
    <div class="chart-container">
        <h2 class="chart-heading">Match Rate</h2>
        <p class="chart-subheading">Your match percentage: <span id="match-percentage"></span>%</p>
        <canvas id="chart" width="300" height="300"></canvas>
        <p class="chart-subheading">Out of a total 100</p>
       
    
        <div class="points-container">
            <div>
              <div class="points-bar">
                <div class="progress" id="progress1"></div>
                <span class="points-text" id="points-text1">0%</span>
              </div>
              <div class="points-label">Hard Skill Match</div>
            </div>
            
            <div>
              <div class="points-bar">
                <div class="progress" id="progress2"></div>
                <span class="points-text" id="points-text2">0%</span>
              </div>
              <div class="points-label">Soft Skill Match</div>
            </div>
            
            <div>
              <div class="points-bar">
                <div class="progress" id="progress3"></div>
                <span class="points-text" id="points-text3">0%</span>
              </div>
              <div class="points-label">Total Match</div>
            </div>
          </div></div>

    <script>
        function drawChart(percentage, context, centerX, centerY, radius, startAngle, animationProgress) {
            // Clear canvas
            context.clearRect(0, 0, context.canvas.width, context.canvas.height);

            var colorRanges = [
            { percentage: 25, color: "#ff0000" },     // Red
            { percentage: 50, color: "#ffa500" },   //orange
            { percentage: 75, color: "#00ff00" },   //blue
            { percentage: 100, color: "rgb(16, 185, 129)" }   // Green
        ];

        // Find the appropriate color based on the percentage
        var color = colorRanges.find(function (range) {
            return percentage <= range.percentage;
        }).color;
            
            // Draw the background circle
            context.beginPath();
            context.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            context.strokeStyle = "#eee";
            context.lineWidth = 20;
            context.stroke();

            // Calculate the end angle based on animation progress
            var endAngle = startAngle + (2 * Math.PI * animationProgress * percentage / 100);

            // Draw the filled portion of the circle
            context.beginPath();
            context.arc(centerX, centerY, radius, startAngle, endAngle);
            context.strokeStyle = color;
            context.lineWidth = 20;
            context.lineCap = "round";
            context.stroke();

            // Draw a point at the end of the filled portion
            var pointRadius = 12;
            var pointX = centerX + Math.cos(endAngle) * radius;
            var pointY = centerY + Math.sin(endAngle) * radius;
            context.beginPath();
            context.arc(pointX, pointY, pointRadius, 0, 2 * Math.PI);
            context.fillStyle = color;
            context.fill();

            // Add text inside the chart
            context.font = "bold 30px Arial";
            context.fillStyle = "#333";
            context.textAlign = "center";
            context.textBaseline = "middle";
            context.fillText(percentage + "%", centerX, centerY);
        }

        function animateChart(percentage) {
            var canvas = document.getElementById("chart");
            var context = canvas.getContext("2d");

            var centerX = canvas.width / 2;
            var centerY = canvas.height / 2;
            var radius = canvas.width / 2 - 50;
            var startAngle = -0.5 * Math.PI;
            var animationDuration = 2000; // Animation duration in milliseconds

            var animationStart = null;

            function animationStep(timestamp) {
                if (!animationStart) animationStart = timestamp;
                var animationProgress = (timestamp - animationStart) / animationDuration;

                // Limit animation progress to a maximum of 1
                if (animationProgress > 1) animationProgress = 1;

                // Call the drawChart function with animation progress
                drawChart(percentage, context, centerX, centerY, radius, startAngle, animationProgress);

                if (animationProgress < 1) {
                    // Continue the animation
                    requestAnimationFrame(animationStep);
                }
            }

            // Start the animation
            requestAnimationFrame(animationStep);
        }

        // Example usage
        var matchPercentage = {{match_rate}}; // Replace with your actual match percentage
        document.getElementById("match-percentage").textContent = matchPercentage;
        animateChart(matchPercentage);
    </script>
    <script>
        function animatePointsBar(progressId, pointsTextId, percentage) {
          var progressElement = document.getElementById(progressId);
          var pointsTextElement = document.getElementById(pointsTextId);
          var width = 0;
          var animationDuration = 1000; // Animation duration in milliseconds
          var increment = percentage / (animationDuration / 10); // Calculate the increment per 10 milliseconds
    
          function calculateColor(currentWidth) {
            var red = 255;
            var green = Math.round(255 - (255 * (currentWidth / 100)));
            var blue = 0;
            return 'rgb(' + blue + ',' + green + ',' + red + ')';
          }
    
          function animationStep() {
            width += increment;
            progressElement.style.width = width + '%';
            pointsTextElement.textContent = Math.round(width) + '%';
            progressElement.style.backgroundColor = calculateColor(width);
    
            if (width < percentage) {
              requestAnimationFrame(animationStep);
            }
          }
    
          animationStep();
        }
    
        var matchPercentage1 = {{hmatch_rate}}; // Replace with your actual match percentage for bar 1
        animatePointsBar('progress1', 'points-text1', matchPercentage1);
    
        var matchPercentage2 = {{smatch_rate}}; // Replace with your actual match percentage for bar 2
        animatePointsBar('progress2', 'points-text2', matchPercentage2);
    
        var matchPercentage3 = {{match_rate}}; // Replace with your actual match percentage for bar 3
        animatePointsBar('progress3', 'points-text3', matchPercentage3);
      </script>
    <div><center>
        <div class="upload" style="font-size:20px">
        <h2 style="background-color:rgb(0, 140, 255);color:black;">Common Skills found </h2>
        {{Cskills}}
        
    
    <h2 style="background-color:rgb(0, 140, 255);color:black;">Job Description Match Report </h2></center>
    </div>

</body>
</html>

{% endblock %}